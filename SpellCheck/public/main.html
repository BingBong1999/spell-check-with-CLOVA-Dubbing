<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>Calculate Opposite Spells!</title>

<style>
		.entire_view {
            width: 800px;
            margin: auto;
            margin-top: 100px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid gray;
            padding: 8px;
            text-align: center;
        }
        th {
        	width: 150px;
        }
        td {
        	width: 500px;
        }
        
</style>

<script>
	
	const CLICK_LOCATION_TO_POSITION_INDEX = {
		top2Btn: 0,
		jg2Btn: 1,
		mid2Btn: 2,
		ad2Btn: 3,
		sup2Btn: 4
	}
	
	const CLICK_LOCATION_TO_WHOSE_VOICE = {
		top2Btn: 'audio/top.mp3',
		jg2Btn: 'audio/jg.mp3',
		mid2Btn: 'audio/mid.mp3',
		ad2Btn: 'audio/ad.mp3',
		sup2Btn: 'audio/sup.mp3'
	}
	
	const POSITION_INDEX_TO_LANE = {
		0: "Top",
		1: "Jug",
		2: "Mid",
		3: "Ad",
		4: "Sup"
	}

	var imgUrl = ["image/barrier.webp", "image/cleanse.webp", 
					"image/exhaust.webp", "image/flash.webp",
					"image/ghost.webp", "image/heal.webp",
					"image/ignite.webp", "image/smite.webp",
					"image/teleport.webp"];
	
	var coolTime = [180000, 210000, 210000, 300000, 210000, 240000, 180000, 0, 240000];
	
	var audioUrl = ["audio/barrier.mp3", "audio/cleanse.mp3", 
					"audio/exhaust.mp3", "audio/flash.mp3",
					"audio/ghost.mp3", "audio/heal.mp3",
					"audio/ignite.mp3", "audio/smite.mp3",
					"audio/teleport.mp3"];
	
	var timer;
	
	var uptime = 0;
	
	function clickSpellChoiceBtn(SpellChoiceBtnId, locationOfSpellChoiceBtn) {
		removeSpellChoiceBtn(SpellChoiceBtnId);
		createAllSpell(locationOfSpellChoiceBtn);
	}
	
	function removeSpellChoiceBtn(SpellChoiceBtnId) {
		var btn = document.getElementById(SpellChoiceBtnId);
		btn.style.display = "none";
	}
	
	function createAllSpell(locationOfSpellChoiceBtn) {
		var spellSpace = document.getElementById(locationOfSpellChoiceBtn);
		
		for ( var i = 0; i < imgUrl.length; i++ ) {	
			
			var spell = document.createElement("img");
			spell.src = imgUrl[i];
			spell.style.marginRight = "5px";
			spell.id = i;
			spell.onclick = function() {
				decideSpell(locationOfSpellChoiceBtn, this.id);
			};
			
			spellSpace.appendChild(spell);
		}
	}
	
	function decideSpell(locationOfSpells, spellId) {	
		removeAllSpell(locationOfSpells);
		createSpell(spellId, locationOfSpells);
	}
	
	function removeAllSpell(locationOfSpells) {
		var spellsSpace = document.getElementById(locationOfSpells);
		
		while( spellsSpace.firstChild ) {
			spellsSpace.removeChild(spellsSpace.firstChild);
		}
	}
	
	function createSpell(spellId, locationOfSpells) {
		var spellSpace = document.getElementById(locationOfSpells);
		var spell = document.createElement("img");
		
		spell.src = imgUrl[spellId];
		spell.id = spellId;
		spell.addEventListener("click", () => clickSpell(spell, spellSpace));
		
		spellSpace.appendChild(spell);
	}
	
	function clickSpell(spell, flashOwner) {
		darkenSpell(spell);
		updateFlashMemo(spell, flashOwner);
			
		setTimeout(handleAfterCoolExpired(flashOwner, spell), coolTime[spell]);
		
		resetFlashMemo(spell, flashOwner);
		//brightenSpell(spell);
	}
	
	function darkenSpell(spell) {
		spell.style.transition = "brightness 1s";
		spell.style.filter = "brightness(0.5)";
	}
	
	function brightenSpell(spell) {		
		spell.style.transition = "brightness 1s";
		spell.style.filter = "brightness(1)";
	}
	
	function updateFlashMemo(spell, flashOwner) {		
		var memoSpace = document.getElementById("memo");
		var comment = memoSpace.value;
		var commentListByPosition = comment.split('\n');
		var newComment = "";
			
		if ( spell.id == 3 ) { // 점멸일 경우에만 메모 계산
				
			var min = Math.floor((uptime + 300) / 60);
			var sec = (uptime + 300) % 60;
			
			var positionIndex = CLICK_LOCATION_TO_POSITION_INDEX.flashOwner;
			
			commentListByPosition[positionIndex] = POSITION_INDEX_TO_LANE.positionIndex + min + " " + sec;
				
			for( var i = 0; i < commentListByPosition.length; i++ ) {
				newComment += commentListByPosition[i] + "\n";
			}

			memoSpace.value = newComment;
		}
	}
	
	function handleAfterCoolExpired(flashOwner, spell) {
		
		var who = new Audio(CLICK_LOCATION_TO_WHOSE_VOICE.flashOwner);

		var what = new Audio(audioUrl[spell]);

		var done = new Audio('audio/exist.mp3');

		who.play();

		setTimeout(function() {
			what.play();
		}, 700);

		setTimeout(function() {
			done.play();
		}, 1400);

	}
	
	function resetFlashMemo(spell, flashOwner) {
		var memoSpace = document.getElementById("memo");
		var comment = memoSpace.value;
		var commentListByPosition = comment.split('\n');
		var newComment = "";
			
		if ( spell.id == 3 ) { // 점멸일 경우에만 메모 계산
			
			var positionIndex = CLICK_LOCATION_TO_POSITION_INDEX.flashOwner;
			
			commentListByPosition[positionIndex] = POSITION_INDEX_TO_LANE.positionIndex  + " ";
				
			for( var i = 0; i < commentListByPosition.length; i++ ) {
				newComment += commentListByPosition[i] + "\n";
			}

			memoSpace.value = newComment;
		}
	}
	
	function cleanFlashMemo() {
		document.getElementById("memo").value = "top\njg\nmid\nad\nsup\n"
	}
	
	function gameStart() {
		timer = setInterval(updateTimer, 1000);
		
		document.getElementById("start").disabled = true;
		document.getElementById("stop").disabled = false;		
	}
	
	function updateTimer() {
		uptime++;
	}
	
	function gameEnd() {
		clearInterval(timer);
		
		document.getElementById("start").disabled = false;
		document.getElementById("stop").disabled = true;
		
		cleanFlashMemo
		
		location.reload();
	}	
</script>

</head>
<body>
<div class = "entire_view">
<table border="1">
    <tr>
        <td>탑</td>
        <td id="topSpell1"><input type="button" onclick="clickSpellChoiceBtn('top1Btn', 'topSpell1')" value="스펠 선택" id="top1Btn"/></td>
        <td id="topSpell2"><input type="button" onclick="clickSpellChoiceBtn('top2Btn', 'topSpell2')" value="스펠 선택" id="top2Btn"/></td>
    </tr>
    
    <tr>
        <td>정글</td>
        <td id="jgSpell1"><input type="button" onclick="clickSpellChoiceBtn('jg1Btn', 'jgSpell1')" value="스펠 선택" id="jg1Btn"/></td>
        <td id="jgSpell2"><input type="button" onclick="clickSpellChoiceBtn('jg2Btn', 'jgSpell2')" value="스펠 선택" id="jg2Btn"/></td>
    </tr>
    
    <tr>
        <td>미드</td>
        <td id="midSpell1"><input type="button" onclick="clickSpellChoiceBtn('mid1Btn', 'midSpell1')" value="스펠 선택" id="mid1Btn"/></td>
        <td id="midSpell2"><input type="button" onclick="clickSpellChoiceBtn('mid2Btn', 'midSpell2')" value="스펠 선택" id="mid2Btn"/></td>
    </tr>
    
    <tr>
        <td>원딜</td>
        <td id="adSpell1"><input type="button" onclick="clickSpellChoiceBtn('ad1Btn', 'adSpell1')" value="스펠 선택" id="ad1Btn"/></td>
        <td id="adSpell2"><input type="button" onclick="clickSpellChoiceBtn('ad2Btn', 'adSpell2')" value="스펠 선택" id="ad2Btn"/></td>
    </tr>
    
    <tr>
        <td>서폿</td>
        <td id="supSpell1"><input type="button" onclick="clickSpellChoiceBtn('sup1Btn', 'supSpell1')" value="스펠 선택" id="sup1Btn"/></td>
        <td id="supSpell2"><input type="button" onclick="clickSpellChoiceBtn('sup2Btn', 'supSpell2')" value="스펠 선택" id="sup2Btn"/></td>
    </tr>
    
</table>

<br>
<br>

<textarea id="memo" rows="8" cols="50">
top
jg
mid
ad
sup
</textarea>

<button id = "start" onclick="gameStart()"> 게임 시작 </button>
<button id = "stop" onclick="gameEnd()"> 게임 종료 </button>

</div>
</body>
</html>